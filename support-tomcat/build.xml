<?xml version="1.0"?>

<project name="support-tomcat" basedir="." default="compile">
	<import file="../build-common-java.xml" />

	<property name="deploy.dir" value="${app.server.dir}/server/lib" />
	<property name="jar.file" value="${ant.project.name}" />

	<target name="compile">
		<mkdir dir="classes" />

		<path id="web-lib.classpath">
			<pathelement path="${project.dir}/portal-kernel/classes" />
			<fileset dir="${project.dir}/lib/development" includes="catalina.jar,tomcat-util.jar" />
			<fileset dir="${project.dir}/lib/portal" includes="jmx-ri.jar" />
		</path>

		<javac
			classpathref="web.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="classes"
			fork="${javac.fork}"
			memoryMaximumSize="${javac.memoryMaximumSize}"
			nowarn="on"
			srcdir="src"
		/>

		<!--
		LEP-2995
		-->

		<mkdir dir="classes/com/liferay/portal/security/jaas" />

		<copy todir="classes/com/liferay/portal/security/jaas" failonerror="false">
			<fileset
				dir="${project.dir}/portal-impl/classes/com/liferay/portal/security/jaas"
				includes="PortalPrincipal.class,PortalRole.class"
			/>
			<fileset
				dir="${project.dir}/portal-web/docroot/WEB-INF/classes/com/liferay/portal/security/jaas"
				includes="PortalPrincipal.class,PortalRole.class"
			/>
		</copy>
	</target>

	<target name="deploy">
		<delete file="${deploy.dir}/support-catalina.jar" />

		<antcall target="build-common-java.deploy" />
	</target>
</project>