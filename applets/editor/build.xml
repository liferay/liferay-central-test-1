<?xml version="1.0"?>

<project name="editor" basedir="." default="compile">
	<property name="project.dir" value="../.." />

	<import file="${project.dir}/build-common-java.xml" />

	<property name="deploy.dir" value="${project.dir}/portal-web/docroot/applets" />
	<property name="jar.file" value="${ant.project.name}" />

	<target name="clean" depends="build-common-java.clean">
		<delete file="${jar.file}-temp.jar" />
	</target>

	<target name="compile">

		<!--
		The editor applet cannot properly compile with Jikes.
		-->

		<mkdir dir="classes" />
		<javac
			classpathref="project.classpath"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="classes"
			nowarn="${javac.nowarn}"
			srcdir="src"
			source="1.3"
			target="1.3"
		/>
	</target>

	<target name="jar" depends="compile">
		<jar
			basedir="classes"
			jarfile="${jar.file}-temp.jar"
		/>

		<if>
			<not>
				<equals arg1="${signjar.alias}" arg2="" />
			</not>
			<then>

				<!--
				To generate a key for a specified alias, type:

				keytool -genkey -alias ${signjar.alias}
				-->

				<signjar
					jar="${jar.file}-temp.jar"
					alias="${signjar.alias}"
					storepass="${signjar.password}"
					signedjar="${ant.project.name}.jar"
				/>
			</then>
			<else>
				<copy file="${jar.file}-temp.jar" tofile="${jar.file}.jar" />
			</else>
		</if>
	</target>

	<target name="deploy" depends="jar">
		<copy
			file="${jar.file}.jar"
			tofile="${deploy.dir}/${jar.file}.jar"
			overwrite="true"
		/>
	</target>

	<target name="run" depends="compile">
		<java
			classname="com.liferay.applets.editor.Editor"
			classpathref="project.classpath"
			fork="true"
		/>
	</target>
</project>