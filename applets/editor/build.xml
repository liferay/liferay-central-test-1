<?xml version="1.0"?>

<project name="editor" basedir="." default="compile">
	<property name="project.dir" value="../.." />

	<import file="${project.dir}/build-common-java.xml" />

	<property name="deploy.dir" value="${project.dir}/portal-web/docroot/applets" />
	<property name="jar.file" value="${ant.project.name}" />

	<target name="compile">

		<!--
		The editor applet cannot properly compile with Jikes.
		-->

		<mkdir dir="classes" />
		<javac
			classpathref="project.classpath"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="classes"
			nowarn="${javac.nowarn}"
			srcdir="src"
			source="1.3"
			target="1.3"
		/>
	</target>

	<target name="jar" depends="compile">
		<jar
			basedir="classes"
			jarfile="${jar.file}.jar"
		/>

		<antcall target="signjar" />
	</target>

	<target name="signjar" if="signjar.alias">

		<!--
		The SignJar task assumes you have already generated a valid alias. To
		generate a key for a specified alias, type:

		keytool -genkey -alias ${signjar.alias}
		-->

		<signjar
			jar="${jar.file}.jar"
			alias="${signjar.alias}"
			storepass="${signjar.password}"
			signedjar="${ant.project.name}-signed.jar"
		/>
	</target>

	<target name="deploy" depends="jar">
		<copy
			file="${jar.file}.jar"
			tofile="${deploy.dir}/${jar.file}.jar"
			overwrite="true"
		/>

		<copy
			file="${jar.file}-signed.jar"
			tofile="${deploy.dir}/${jar.file}.jar"
			overwrite="true"
			failonerror="false"
		/>
	</target>

	<target name="run" depends="compile">
		<java
			classname="com.liferay.applets.editor.Editor"
			classpathref="project.classpath"
			fork="true"
		/>
	</target>
</project>