Index: third-party/javascript_creole_wiki_markup_parser.js
===================================================================
@@ -25,6 +25,7 @@
  * DEALINGS IN THE SOFTWARE.
  */

+(function(){
 if (!Parse) { var Parse = {}; }
 if (!Parse.Simple) { Parse.Simple = {}; }

@@ -43,7 +44,7 @@

     parse: function(node, data, options) {
         if (options) {
-            for (i in this.options) {
+			for (var i in this.options) {
                 if (typeof options[i] == 'undefined') { options[i] = this.options[i]; }
             }
         }
@@ -146,7 +147,7 @@

             var chopped = best.index + best[0].length;
             tail = tail.substring(chopped);
-            for (var i = 0; i < this.children.length; i++) {
+			for (i = 0; i < this.children.length; i++) {
                 if (matches[i]) {
                     if (matches[i].index >= chopped) {
                         matches[i].index -= chopped;
@@ -244,8 +245,19 @@

         img: { regex: rx.img,
             build: function(node, r, options) {
+				var imagePath = r[1];
+				var imagePathPrefix = options ? options.imagePrefix : '';
+
                 var img = document.createElement('img');
-                img.src = r[1];
+
+				if (imagePathPrefix) {
+					if (!(/^https?:\/\//gi.test(imagePath))) {
+						imagePath = imagePathPrefix + imagePath;
+					}
+				}
+
+				img.src = imagePath;
+
                 img.alt = r[2] === undefined
                     ? (options && options.defaultImageText ? options.defaultImageText : '')
                     : r[2].replace(/~(.)/g, '$1');
@@ -369,3 +381,6 @@
 Parse.Simple.Creole.prototype = new Parse.Simple.Base();

 Parse.Simple.Creole.prototype.constructor = Parse.Simple.Creole;
+
+CKEDITOR.CreoleParser = Parse.Simple.Creole;
+}());
