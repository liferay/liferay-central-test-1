Liferay.autoFields2=new Class({initialize:function(D){var B=this;B._idSeed=D.lastIndex;B._itemsArray=D.itemsArray;var C=jQuery(D.container);var H=jQuery(D.baseRows);var A=jQuery("<div class=\"row-container\"></div>");var E=jQuery("<div class=\"form-row\"></div>");var G=jQuery("<span class=\"row-controls\"><a href=\"javascript: ;\" class=\"add-row\">Add row</a><a href=\"javascript: ;\" class=\"delete-row\">Delete row</a></span>");var F=jQuery("<div class=\"portlet-msg-info undo-queue queue-empty\"><a class=\"undo-action\" href=\"javascript: ;\">Undo <span class=\"items-left\">(0)</span></a><a class=\"clear-undos\" href=\"javascript: ;\">Clear History</a></div>");A.click(function(J){if(J.target.parentNode.className.indexOf("row-controls")>-1){var K=jQuery(J.target);var I=K.parents(".form-row:first")[0];if(K.is(".add-row")){B.addRow(I)}if(K.is(".delete-row")){B.deleteRow(I)}}});B._container=C;B._rowContainer=A;B._undoManager=F;B._undoItemsLeft=F.find(".items-left");B._undoButton=F.find(".undo-action");B._clearUndos=F.find(".clear-undos");B._clearUndos.click(function(I){B._undoCache=[];B._rowContainer.find(".form-row:hidden").remove();Liferay.trigger("updateUndoList")});B._undoButton.click(function(I){B.undoLast()});A.prepend(F);H.each(function(L){var J;var I=G.clone();var K=jQuery(this);if(K.is(".form-row")){J=K}else{J=E.clone();J.append(this)}J.append(I);A.append(J);if(L==0){B._rowTemplate=J.clone();B._rowTemplate.clearForm()}});C.append(A);Liferay.bind("updateUndoList",function(I){B._updateUndoList()})},addRow:function(C){var A=this;var B=jQuery(C);var E=B.clone(true);var D=(A._idSeed++)+1;if(D<10){D="0"+D}E.find("input,select").each(function(){var I=jQuery(this);var H=I.attr("name");var G=H.substring(0,H.length-2);var F=G+D;if(!I.is(":radio")){I.attr("name",F)}I.attr("name",F);I.attr("id",F);E.find("label[for="+H+"]").attr("for",F)});A._itemsArray.push(D);E.clearForm();E.find("input[type=hidden]").each(function(){this.value=""});B.after(E);E.find("input:text:first").trigger("focus")},deleteRow:function(D){var A=this;var F=A._rowContainer.find(".form-row:visible");if(F.length==1){A.addRow(D)}var E=jQuery(D);E.hide();A._queueUndo(E);var G;var B=jQuery(D);B.find("select").each(function(){var I=jQuery(this);var H=I.attr("name");G=H.substring(H.length-2,H.length)});A._undoPostfixes.push(G);for(var C=0;C<A._itemsArray.length;C++){if(G==A._itemsArray[C]){A._itemsArray.splice(C,1)}}},undoLast:function(){var B=this;var A=B._undoCache.length;if(A>0){var C=B._undoCache.pop();C.show();B._itemsArray.push(B._undoPostfixes.pop());Liferay.trigger("updateUndoList")}},serialize:function(D){var B=this;var A=B.baseContainer(".form-row:visible :input");var C="";if(D){D.apply(B,[A])}return""},_updateUndoList:function(){var B=this;var A=B._undoCache.length;var C=B._undoManager;if(A==1){C.addClass("queue-single")}else{C.removeClass("queue-single")}if(A>0){C.removeClass("queue-empty")}else{C.addClass("queue-empty")}B._undoItemsLeft.text("("+A+")")},_queueUndo:function(B){var A=this;A._undoCache.push(B);Liferay.trigger("updateUndoList")},_undoCache:[],_idSeed:0,_itemsArray:[],_undoPostfixes:[]})