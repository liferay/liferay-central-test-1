<%
/**
 * Copyright (c) 2000-2007 Liferay, Inc. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
%>

<%
boolean showEditIcon = false;

String editIconMsg = null;

PortletURL editURL = null;

if (className.equals(BlogsEntry.class.getName())) {
	BlogsEntry entry = BlogsEntryLocalServiceUtil.getEntry(classPK);

	showEditIcon = BlogsEntryPermission.contains(permissionChecker, entry, ActionKeys.UPDATE);

	editIconMsg = "edit-blog";

	editURL = new PortletURLImpl(request, PortletKeys.BLOGS, plid.longValue(), false);

	editURL.setParameter("struts_action", "/blogs/edit_entry");
	editURL.setParameter("entryId", String.valueOf(entry.getEntryId()));
}
else if (className.equals(BookmarksEntry.class.getName())) {
	BookmarksEntry entry = BookmarksEntryLocalServiceUtil.getEntry(classPK);

	showEditIcon = BookmarksEntryPermission.contains(permissionChecker, entry, ActionKeys.UPDATE);

	editIconMsg = "edit-bookmark";

	editURL = new PortletURLImpl(request, PortletKeys.BOOKMARKS, plid.longValue(), false);

	editURL.setParameter("struts_action", "/bookmarks/edit_entry");
	editURL.setParameter("folderId", String.valueOf(entry.getFolderId()));
	editURL.setParameter("entryId", String.valueOf(entry.getEntryId()));
}
else if (className.equals(DLFileEntry.class.getName())) {
	DLFileEntry fileEntry = DLFileEntryLocalServiceUtil.getFileEntry(classPK);

	showEditIcon = DLFileEntryPermission.contains(permissionChecker, fileEntry, ActionKeys.UPDATE);

	editIconMsg = "edit-document";

	editURL = new PortletURLImpl(request, PortletKeys.DOCUMENT_LIBRARY, plid.longValue(), false);

	editURL.setParameter("struts_action", "/document_library/edit_file_entry");
	editURL.setParameter("folderId", String.valueOf(fileEntry.getFolderId()));
	editURL.setParameter("name", fileEntry.getName());
}
else if (className.equals(IGImage.class.getName())) {
	IGImage image = IGImageLocalServiceUtil.getImage(classPK);

	showEditIcon = IGImagePermission.contains(permissionChecker, image, ActionKeys.UPDATE);

	editIconMsg = "edit-image";

	editURL = new PortletURLImpl(request, PortletKeys.IMAGE_GALLERY, plid.longValue(), false);

	editURL.setParameter("struts_action", "/image_gallery/edit_image");
	editURL.setParameter("folderId", String.valueOf(image.getFolderId()));
	editURL.setParameter("imageId", String.valueOf(image.getImageId()));
}
else if (className.equals(JournalArticle.class.getName())) {
	JournalArticleResource articleResource = JournalArticleResourceLocalServiceUtil.getArticleResource(classPK);

	String languageId = LanguageUtil.getLanguageId(request);

	JournalArticleDisplay articleDisplay = null;

	try {
		double latestApprovedVersion = JournalArticleLocalServiceUtil.getLatestVersion(articleResource.getGroupId(), articleResource.getArticleId(), Boolean.TRUE);

		articleDisplay = JournalArticleLocalServiceUtil.getArticleDisplay(articleResource.getGroupId(), articleResource.getArticleId(), languageId, themeDisplay);
	}
	catch (NoSuchArticleException nsae) {

		// No version has been approved yet, the article should not be rendered

	}

	if (articleDisplay != null) {
		showEditIcon = JournalArticlePermission.contains(permissionChecker, articleDisplay.getGroupId(), articleDisplay.getArticleId(), ActionKeys.UPDATE);

		editIconMsg = "edit-article";

		editURL = new PortletURLImpl(request, PortletKeys.JOURNAL, plid.longValue(), false);

		editURL.setParameter("struts_action", "/journal/edit_article");
		editURL.setParameter("groupId", String.valueOf(articleDisplay.getGroupId()));
		editURL.setParameter("articleId", articleDisplay.getArticleId());
		editURL.setParameter("version", String.valueOf(articleDisplay.getVersion()));
	}
}
else if (className.equals(WikiPage.class.getName())) {
	WikiPageResource pageResource = WikiPageResourceLocalServiceUtil.getPageResource(classPK);

	WikiPage wikiPage = WikiPageLocalServiceUtil.getPage(pageResource.getNodeId(), pageResource.getTitle());

	WikiNode node = wikiPage.getNode();

	showEditIcon = WikiPagePermission.contains(permissionChecker, wikiPage, ActionKeys.UPDATE);

	editIconMsg = "edit-page";

	editURL = new PortletURLImpl(request, PortletKeys.WIKI, plid.longValue(), false);

	editURL.setParameter("struts_action", "/wiki/edit_page");
	editURL.setParameter("nodeId", String.valueOf(wikiPage.getNodeId()));
	editURL.setParameter("title", wikiPage.getTitle());
}

if (editURL != null) {
	editURL.setWindowState(WindowState.MAXIMIZED);
	editURL.setPortletMode(PortletMode.VIEW);

	editURL.setParameter("redirect", currentURL);
}
%>

<c:if test="<%= showEditIcon %>">
	<div>
		<br />

		<liferay-ui:icon image="edit" message="<%= editIconMsg %>" url="<%= editURL.toString() %>" />
	</div>
</c:if>