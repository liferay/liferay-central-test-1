<%
/**
 * Copyright (c) 2000-2009 Liferay, Inc. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
%>

<%
String workflowId = portletDisplay.getNamespace() + "workflow";
String workflowTitle = LanguageUtil.get(pageContext, "workflow");

String formStructureId = portletDisplay.getNamespace() + "formStructure";
String formStructureTitle = LanguageUtil.get(pageContext, "structure");
String formTemplateId = portletDisplay.getNamespace() + "formTemplate";
String formTemplateTitle = LanguageUtil.get(pageContext, "template");

String categorizationId = portletDisplay.getNamespace() + "categorization";
String categorizationTitle = LanguageUtil.get(pageContext, "categorization");

String scheduleId = portletDisplay.getNamespace() + "schedule";
String scheduleTitle = LanguageUtil.get(pageContext, "schedule");
%>

<liferay-ui:toggle-area
	id="toggle_id_journal_edit_article_extra"
	showMessage='<%= LanguageUtil.get(pageContext, "advanced") + " &raquo;" %>'
	hideMessage='<%= "&laquo; " + LanguageUtil.get(pageContext, "basic") %>'
	align="right"
>
	<liferay-ui:panel-container id='<%= portletDisplay.getNamespace() + "journalExtras" %>' persistState="<%= true %>" extended="<%= Boolean.FALSE %>" cssClass="journal-extras">
		<liferay-ui:panel id="<%= formStructureId %>" title="<%= formStructureTitle %>" defaultState="open" persistState="<%= true %>" extended="<%= false %>">
			<div class="journal-form-presentation-label">
				<input name="<portlet:namespace />structureId" type="hidden" value="<%= structureId %>" />
				<input name="<portlet:namespace />structureName" type="hidden" value="<%= structureName %>" />
				<input name="<portlet:namespace />structureDescription" type="hidden" value="<%= structureDescription %>" />
				<input name="<portlet:namespace />structureXSD" type="hidden" value="<%= JS.encodeURIComponent(structureXSD) %>" />

				<liferay-ui:message key="name" />:

				<span id="<portlet:namespace />structureNameLabel" class="structure-name-label">
					<%= structureName %>

					<c:if test="<%= Validator.isNotNull(structureId) %>">
						<span class="default-link">(<a href="javascript:;" id="<portlet:namespace />loadDefaultStructure"><liferay-ui:message key="use-default" /></a>)</span>
					</c:if>
				</span>
			</div>

			<div id="<portlet:namespace />structureMessage" class="portlet-msg-alert structure-message">
				<liferay-ui:message key="this-structure-has-not-been-saved" />

				<%= LanguageUtil.format(pageContext, "click-here-to-save-it-now", new Object[] {"journal-save-structure-trigger", "#"}) %>
			</div>

			<div class="structure-controls">
				<span class="structure-buttons">
					<input class="save-structure-button" id="<portlet:namespace />saveStructureBtn" type="button" value="<liferay-ui:message key="save" />" />

					<input class="edit-structure-button" id="<portlet:namespace />editStructureBtn" type="button" value="<liferay-ui:message key="edit" />" />
				</span>

				<span class="structure-links">
					<a data-changeStructureUrl="<portlet:renderURL windowState="<%= LiferayWindowState.POP_UP.toString() %>"><portlet:param name="struts_action" value="/journal/select_structure" /><portlet:param name="groupId" value="<%= String.valueOf(groupId) %>" /></portlet:renderURL>" href="javascript:;" id="<portlet:namespace />changeStructureBtn">
						<liferay-ui:message key="choose" />
					</a>
				</span>
			</div>

			<div id="<portlet:namespace />journalComponentList" class="journal-article-component-list">
				<div class="component-group form-controls">
					<div class="component-group-title">
						<liferay-ui:message key="form-controls" />
					</div>

					<div class="journal-component journal-component-text" data-component-type="text">
						<liferay-ui:message key="text-field" />
					</div>

					<div class="journal-component journal-component-textbox" data-component-type="text_box">
						<liferay-ui:message key="text-box" />
					</div>

					<div class="journal-component journal-component-textarea" data-component-type="text_area">
						<liferay-ui:message key="text-area" />
					</div>

					<div class="journal-component journal-component-boolean" data-component-type="boolean">
						<liferay-ui:message key="checkbox" />
					</div>

					<div class="journal-component journal-component-list" data-component-type="list">
						<liferay-ui:message key="selectbox" />
					</div>

					<div class="journal-component journal-component-multilist" data-component-type="multi-list">
						<liferay-ui:message key="multi-selection-list" />
					</div>
				</div>

				<br />

				<div class="component-group form-controls">
					<div class="component-group-title">
						<liferay-ui:message key="application-fields" />
					</div>

					<div class="journal-component journal-component-imagegallery" data-component-type="image_gallery">
						<liferay-ui:message key="image-gallery" />
					</div>

					<div class="journal-component journal-component-image" data-component-type="image">
						<liferay-ui:message key="image-uploader" />
					</div>

					<div class="journal-component journal-component-documentlibrary" data-component-type="document_library">
						<liferay-ui:message key="document-library" />
					</div>
				</div>

				<br />

				<div class="component-group form-controls">
					<div class="component-group-title">
						<liferay-ui:message key="misc" />
					</div>

					<div class="journal-component journal-component-linktolayout" data-component-type="link_to_layout">
						<liferay-ui:message key="link-to-page" />
					</div>

					<div class="journal-component journal-component-selectionbreak" data-component-type="selection_break">
						<liferay-ui:message key="selection-break" />
					</div>
				</div>
			</div>
		</liferay-ui:panel>

		<liferay-ui:panel id="<%= formTemplateId %>" title="<%= formTemplateTitle %>" defaultState="open" persistState="<%= true %>" extended="<%= false %>">
			<div class="journal-form-presentation-label">
				<c:choose>
					<c:when test="<%= templates.size() == 0 %>">
						<input name="<portlet:namespace />templateId" type="hidden" value="<%= templateId %>" />

						<div class="journal-article-required-message portlet-msg-info">
							<liferay-ui:message key="please-select-a-template-first" />
						</div>

						<input type="button" value="<liferay-ui:message key="select" />"
							onClick="
								if (confirm('<%= UnicodeLanguageUtil.get(pageContext, "selecting-a-template-will-change-the-structure,-available-input-fields,-and-available-templates") %>')) {
									var templateWindow = window.open('<portlet:renderURL windowState="<%= LiferayWindowState.POP_UP.toString() %>"><portlet:param name="struts_action" value="/journal/select_template" /><portlet:param name="groupId" value="<%= String.valueOf(groupId) %>" /></portlet:renderURL>', 'template', 'directories=no,height=640,location=no,menubar=no,resizable=yes,scrollbars=yes,status=no,toolbar=no,width=680');
									void('');
									templateWindow.focus();
								}"
						/>
					</c:when>
					<c:otherwise>

					<liferay-ui:message key="template" />:

						<liferay-ui:table-iterator
							list="<%= templates %>"
							listType="com.liferay.portlet.journal.model.JournalTemplate"
							rowLength="3"
							rowPadding="30"
						>

							<%
							boolean templateChecked = false;

							if (templateId.equals(tableIteratorObj.getTemplateId())) {
								templateChecked = true;
							}

							if ((tableIteratorPos.intValue() == 0) && Validator.isNull(templateId)) {
								templateChecked = true;
							}
							%>

							<input id="<portlet:namespace />template<%= tableIteratorObj.getTemplateId() %>_xsl" type="hidden" value="<%= JS.encodeURIComponent(tableIteratorObj.getXsl()) %>" />

							<input <%= templateChecked ? "checked" : "" %> name="<portlet:namespace />templateId" type="radio" value="<%= tableIteratorObj.getTemplateId() %>" />

							<a href="<portlet:renderURL windowState="<%= WindowState.MAXIMIZED.toString() %>"><portlet:param name="struts_action" value="/journal/edit_template" /><portlet:param name="redirect" value="<%= currentURL %>" /><portlet:param name="groupId" value="<%= String.valueOf(tableIteratorObj.getGroupId()) %>" /><portlet:param name="templateId" value="<%= tableIteratorObj.getTemplateId() %>" /></portlet:renderURL>">
							<%= tableIteratorObj.getName() %></a>

							<c:if test="<%= tableIteratorObj.isSmallImage() %>">
								<br />

								<img border="0" hspace="0" src="<%= Validator.isNotNull(tableIteratorObj.getSmallImageURL()) ? tableIteratorObj.getSmallImageURL() : themeDisplay.getPathImage() + "/journal/template?img_id=" + tableIteratorObj.getSmallImageId() + "&t=" + ImageServletTokenUtil.getToken(tableIteratorObj.getSmallImageId()) %>" vspace="0" />
							</c:if>
						</liferay-ui:table-iterator>
					</c:otherwise>
				</c:choose>
			</div>
		</liferay-ui:panel>

		<liferay-ui:panel id="<%= workflowId %>" title="<%= workflowTitle %>" defaultState="closed" persistState="<%= true %>" extended="<%= false %>">
			<c:if test="<%= article != null %>">
				<liferay-ui:message key="version" />

				<select onChange="<portlet:namespace />changeVersionView(this.value);">

					<%
					List<JournalArticle> articleVersions = JournalArticleLocalServiceUtil.getArticles(article.getGroupId(), article.getArticleId());

					for (JournalArticle curArticle : articleVersions) {

					%>

						<option <%= (curArticle.getVersion() == article.getVersion()) ? "selected" : "" %> value="<%= curArticle.getVersion() %>"><%= curArticle.getVersion() %></option>

					<%
					}
					%>

				</select>

				<br /><br />
			</c:if>

			<liferay-ui:message key="status" />

			<%
			String status = null;

			if (article == null) {
				status = "new";
			}
			else if (article.isExpired()) {
				status = "expired";
			}
			else if (article.isApproved()) {
				status = "approved";
			}
			else {
				status = "not-approved";
			}
			%>

			<b class="journal-article-status journal-article-status-<%= status %>"><liferay-ui:message key="<%= status %>" /></strong>

			<c:if test="<%= article != null %>">
				<br /><br />

				<span class="nobr">
					<liferay-ui:message key="increment-version-on-save" />

					<liferay-ui:input-checkbox param="incrementVersion" defaultValue="<%= incrementVersion %>" disabled="<%= disableIncrementVersion %>" />
				</span>

				<br /><br />

				<c:if test="<%= !article.isApproved() && JournalPermission.contains(permissionChecker, scopeGroupId, ActionKeys.APPROVE_ARTICLE) %>">
					<input type="button" value="<liferay-ui:message key="approve" />" onClick="<portlet:namespace />approveArticle();" />
				</c:if>

				<c:if test="<%= !article.isExpired() && JournalArticlePermission.contains(permissionChecker, article, ActionKeys.EXPIRE) %>">
					<input type="button" value="<liferay-ui:message key="expire" />" onClick="<portlet:namespace />expireArticle();" />
				</c:if>

				<c:if test="<%= JournalArticlePermission.contains(permissionChecker, article, ActionKeys.DELETE) %>">
					<input type="button" value="<liferay-ui:message key="delete" />" onClick="<portlet:namespace />deleteArticle();" />
				</c:if>
			</c:if>
		</liferay-ui:panel>

		<liferay-ui:panel id="<%= categorizationId %>" title="<%= categorizationTitle %>" defaultState="closed" persistState="<%= true %>" extended="<%= false %>">
			<liferay-ui:error exception="<%= ArticleTypeException.class %>" message="please-select-a-type" />

			<liferay-ui:message key="type" /><br />

			<select name="<portlet:namespace />type">
				<option value=""></option>

				<%
				for (int i = 0; i < JournalArticleImpl.TYPES.length; i++) {
				%>

					<option <%= type.equals(JournalArticleImpl.TYPES[i]) ? "selected" : "" %> value="<%= JournalArticleImpl.TYPES[i] %>"><%= LanguageUtil.get(pageContext, JournalArticleImpl.TYPES[i]) %></option>

				<%
				}
				%>

			</select>

			<br /><br />

			<%
			long classPK = 0;

			if (article != null) {
				classPK = article.getResourcePrimKey();
			}
			%>

			<liferay-ui:message key="categories" /><br />

			<liferay-ui:asset-categories-selector
				className="<%= JournalArticle.class.getName() %>"
				classPK="<%= classPK %>"
			/>

			<br /><br />

			<liferay-ui:message key="tags" /><br />

			<liferay-ui:asset-tags-selector
				className="<%= JournalArticle.class.getName() %>"
				classPK="<%= classPK %>"
				contentCallback='<%= renderResponse.getNamespace() + "getSuggestionsContent" %>'
			/>

			<br /><br />

			<liferay-ui:message key="searchable" />

			<liferay-ui:input-field model="<%= JournalArticle.class %>" bean="<%= article %>" field="indexable" />
		</liferay-ui:panel>

		<liferay-ui:panel id="<%= scheduleId %>" title="<%= scheduleTitle %>" defaultState="closed" persistState="<%= true %>" extended="<%= false %>">
			<liferay-ui:error exception="<%= ArticleDisplayDateException.class %>" message="please-enter-a-valid-display-date" />
			<liferay-ui:error exception="<%= ArticleExpirationDateException.class %>" message="please-enter-a-valid-expiration-date" />

			<liferay-ui:message key="display-date" /><br />

			<liferay-ui:input-field formName="fm1" model="<%= JournalArticle.class %>" bean="<%= article %>" field="displayDate" defaultValue="<%= displayDate %>" />

			<br /><br />

			<liferay-ui:message key="expiration-date" /><br />

			<liferay-ui:input-field formName="fm1" model="<%= JournalArticle.class %>" bean="<%= article %>" field="expirationDate" defaultValue="<%= expirationDate %>" disabled="<%= neverExpire %>" /><br />

			<liferay-ui:message key="never-auto-expire" />

			<%
			String taglibNeverExpireOnClick = renderResponse.getNamespace() + "disableInputDate('expirationDate', this.checked);";
			%>

			<liferay-ui:input-checkbox param="neverExpire" defaultValue="<%= neverExpire %>" onClick="<%= taglibNeverExpireOnClick %>" />

			<br /><br />

			<liferay-ui:message key="review-date" /><br />

			<liferay-ui:input-field formName="fm1" model="<%= JournalArticle.class %>" bean="<%= article %>" field="reviewDate" defaultValue="<%= reviewDate %>" disabled="<%= neverReview %>" /><br />

			<liferay-ui:message key="never-review" />

			<%
			String taglibNeverReviewOnClick = renderResponse.getNamespace() + "disableInputDate('reviewDate', this.checked);";
			%>

			<liferay-ui:input-checkbox param="neverReview" defaultValue="<%= neverReview %>" onClick="<%= taglibNeverReviewOnClick %>" />
		</liferay-ui:panel>
	</liferay-ui:panel-container>
</liferay-ui:toggle-area>