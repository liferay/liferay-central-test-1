<?xml version="1.0"?>

<project name="benchmarks" basedir="." default="run">
	<import file="../build-common.xml" />

	<path id="grinder.classpath">
		<fileset dir="lib" includes="*.jar" />
	</path>

	<property name="grinder.file" value="../tools/grinder-3.1.zip" />

	<target name="build-sample-sql">
		<java
			classname="com.liferay.portal.tools.samplesqlbuilder.SampleSQLBuilder"
			classpathref="project.classpath"
			fork="true"
			newenvironment="true"
		>
			<jvmarg value="-Dexternal-properties=com/liferay/portal/tools/dependencies/portal-tools.properties" />
			<jvmarg value="-Dsample.sql.generate.security=${sample.sql.generate.security}" />
			<jvmarg value="-Dsample.sql.output.dir=${sample.sql.output.dir}" />
			<jvmarg value="-Dsample.sql.max.blogs.entry.count=${sample.sql.max.blogs.entry.count}" />
			<jvmarg value="-Dsample.sql.max.groups.count=${sample.sql.max.groups.count}" />
			<jvmarg value="-Dsample.sql.max.mb.category.count=${sample.sql.max.mb.category.count}" />
			<jvmarg value="-Dsample.sql.max.mb.message.count=${sample.sql.max.mb.message.count}" />
			<jvmarg value="-Dsample.sql.max.mb.thread.count=${sample.sql.max.mb.thread.count}" />
			<jvmarg value="-Dsample.sql.max.user.count=${sample.sql.max.user.count}" />
		</java>
	</target>

	<target name="run" depends="setup">
		<java
			classname="net.grinder.Grinder"
			classpathref="grinder.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="setup">
		<if>
			<not>
				<available file="lib" />
			</not>
			<then>
				<unzip src="${grinder.file}" dest="lib">
					<patternset>
						<include name="**/lib/*.jar" />
					</patternset>
					<mapper type="flatten" />
				</unzip>
			</then>
		</if>
	</target>
</project>