<?xml version="1.0"?>

<project name="test" basedir="." default="test">
	<property name="project.dir" value="../.." />

	<import file="${project.dir}/build-common-java.xml" />

	<path id="web-lib.classpath">
	</path>

	<path id="test-junit.classpath">
		<pathelement path="${project.dir}/lib/development/junit.jar" />
		<pathelement path="${project.dir}/test/portal-impl/classes" />
	</path>

	<path id="test-http.classpath">
		<path refid="project.classpath" />
	</path>

	<path id="test-ldap.classpath">
		<path refid="test-junit.classpath" />
	</path>

	<path id="test-service.classpath">
		<pathelement path="${classpath}" />
		<fileset dir="${project.dir}/lib/development" includes="*.jar" />
		<fileset dir="${project.dir}/lib/global" includes="*.jar" />
		<fileset dir="${project.dir}/lib/portal" includes="*.jar" excludes="xalan.jar,xercesImpl.jar" />
	</path>

	<path id="test-soap.classpath">
		<path refid="web.classpath" />
		<path refid="test-junit.classpath" />
		<pathelement path="${project.dir}/lib/development/activation.jar" />
		<pathelement path="${project.dir}/lib/development/mail.jar" />
		<pathelement path="${project.dir}/lib/portal/axis.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-discovery.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-logging.jar" />
		<pathelement path="${project.dir}/lib/portal/jaxrpc.jar" />
		<pathelement path="${project.dir}/lib/portal/saaj.jar" />
		<pathelement path="${project.dir}/lib/portal/wsdl4j.jar" />
		<pathelement path="${project.dir}/portal-client/portal-client.jar" />
	</path>

	<path id="test-spring-remoting.classpath">
		<path refid="test-service.classpath" />
	</path>

	<target name="compile">
		<mkdir dir="classes" />

		<javac
			classpathref="test-service.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="classes"
			nowarn="on"
			srcdir="src"
		/>
	</target>

	<target name="test">
		<echo message="The remoting tests require a running Liferay instance. Make sure that Liferay" />
		<echo message="is listening on a host that matches what is set in test.properties." />
		<echo message="" />

		<antcall target="test-http" />
		<antcall target="test-service" />
		<antcall target="test-soap" />
		<!--<antcall target="test-spring-remoting-hessian" />-->
		<antcall target="test-spring-remoting-http" />
	</target>

	<target name="test-http" depends="compile">
		<java
			classname="com.liferay.test.http.HttpTests"
			classpathref="test-http.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-ldap" depends="compile">
		<java
			classname="com.liferay.test.ldap.LDAPTests"
			classpathref="test-ldap.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-service" depends="compile">
		<java
			classname="com.liferay.test.service.ServiceTests"
			classpathref="test-service.classpath"
			fork="true"
			newenvironment="true"
		>
			<!--<jvmarg value="-Dorg.xml.sax.driver=org.apache.xerces.parsers.SAXParser" />-->
		</java>
	</target>

	<target name="test-soap" depends="compile">
		<java
			classname="com.liferay.test.client.SoapTests"
			classpathref="test-soap.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-spring-remoting-hessian" depends="compile">
		<java
			classname="com.liferay.test.spring.remoting.SpringRemotingTests"
			classpathref="test-spring-remoting.classpath"
			fork="true"
			newenvironment="true"
		>
			<arg value="hessian" />
		</java>
	</target>

	<target name="test-spring-remoting-http" depends="compile">
		<java
			classname="com.liferay.test.spring.remoting.SpringRemotingTests"
			classpathref="test-spring-remoting.classpath"
			fork="true"
			newenvironment="true"
		>
			<arg value="http" />
		</java>
	</target>
</project>