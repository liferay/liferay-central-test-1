<?xml version="1.0"?>

<project name="test" basedir="." default="test">
	<import file="../build-common-java.xml" />

	<path id="web-lib.classpath">
	</path>

	<path id="test-junit.classpath">
		<pathelement path="${project.dir}/lib/development/junit.jar" />
		<pathelement path="${project.dir}/test/classes" />
	</path>

	<path id="test-http.classpath">
		<path refid="project.classpath" />
	</path>

	<path id="test-ldap.classpath">
		<path refid="test-junit.classpath" />
	</path>

	<path id="test-service.classpath">
		<pathelement path="${classpath}" />
		<fileset dir="${project.dir}/lib/development" includes="*.jar" />
		<fileset dir="${project.dir}/lib/global" includes="*.jar" />
		<fileset dir="${project.dir}/lib/portal" includes="*.jar" excludes="xalan.jar,xercesImpl.jar" />
	</path>

	<path id="test-soap.classpath">
		<path refid="web.classpath" />
		<path refid="test-junit.classpath" />
		<pathelement path="${project.dir}/lib/development/activation.jar" />
		<pathelement path="${project.dir}/lib/development/mail.jar" />
		<pathelement path="${project.dir}/lib/portal/axis.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-discovery.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-logging.jar" />
		<pathelement path="${project.dir}/lib/portal/jaxrpc.jar" />
		<pathelement path="${project.dir}/lib/portal/saaj.jar" />
		<pathelement path="${project.dir}/lib/portal/wsdl4j.jar" />
		<pathelement path="${project.dir}/portal-client/portal-client.jar" />
	</path>

	<path id="test-spring-remoting.classpath">
		<path refid="web.classpath" />
		<path refid="test-junit.classpath" />
		<pathelement path="${project.dir}/test/classes" />
		<pathelement path="${project.dir}/lib/portal/commons-beanutils.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-configuration.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-collections.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-digester.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-discovery.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-lang.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-logging.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-codec.jar" />
		<pathelement path="${project.dir}/lib/portal/concurrent.jar" />
		<pathelement path="${project.dir}/lib/portal/easyconf.jar" />
		<pathelement path="${project.dir}/lib/portal/hessian.jar" />
		<pathelement path="${project.dir}/lib/portal/hibernate3.jar" />
		<pathelement path="${project.dir}/lib/portal/jcr.jar" />
		<pathelement path="${project.dir}/lib/portal/log4j.jar" />
		<pathelement path="${project.dir}/lib/portal/oscache.jar" />
		<pathelement path="${project.dir}/lib/portal/spring.jar" />
		<pathelement path="${project.dir}/lib/portal/velocity.jar" />
		<pathelement path="${project.dir}/lib/portal/xstream.jar" />
		<pathelement path="${project.dir}/util-java/util-java.jar" />
		<pathelement path="${project.dir}/portal-impl/portal-impl.jar" />
	</path>

	<target name="compile">
		<mkdir dir="classes" />

		<path id="test-compile.classpath">
			<path refid="test-soap.classpath" />
			<path refid="test-spring-remoting.classpath" />
			<pathelement path="${project.dir}/portal-impl/classes" />
		</path>

		<javac
			classpathref="test-compile.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="classes"
			fork="${javac.fork}"
			memoryMaximumSize="${javac.memoryMaximumSize}"
			nowarn="on"
			srcdir="src"
		/>
	</target>

	<target name="test">
		<echo message="The remoting tests require a running Liferay instance. Make sure that Liferay" />
		<echo message="is listening on a host that matches what is set in test.properties." />
		<echo message="" />

		<antcall target="test-http" />
		<antcall target="test-service" />
		<antcall target="test-soap" />
		<!--<antcall target="test-spring-remoting-hessian" />-->
		<antcall target="test-spring-remoting-http" />
	</target>

	<target name="test-http" depends="compile">
		<java
			classname="com.liferay.test.http.HttpTests"
			classpathref="test-http.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-ldap" depends="compile">
		<java
			classname="com.liferay.test.ldap.LDAPTests"
			classpathref="test-ldap.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-service" depends="compile">
		<java
			classname="com.liferay.test.service.ServiceTests"
			classpathref="test-service.classpath"
			fork="true"
			newenvironment="true"
		>
			<!--<jvmarg value="-Dorg.xml.sax.driver=org.apache.xerces.parsers.SAXParser" />-->
		</java>
	</target>

	<target name="test-soap" depends="compile">
		<java
			classname="com.liferay.test.client.SoapTests"
			classpathref="test-soap.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-spring-remoting-hessian" depends="compile">
		<java
			classname="com.liferay.test.spring.remoting.SpringRemotingTests"
			classpathref="test-spring-remoting.classpath"
			fork="true"
			newenvironment="true"
			args="hessian"
		/>
	</target>

	<target name="test-spring-remoting-http" depends="compile">
		<java
			classname="com.liferay.test.spring.remoting.SpringRemotingTests"
			classpathref="test-spring-remoting.classpath"
			fork="true"
			newenvironment="true"
			args="http"
		/>
	</target>
</project>