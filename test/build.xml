<?xml version="1.0"?>

<project name="test" basedir="." default="test">
	<import file="../build-common-java.xml" />

	<path id="web-lib.classpath">
	</path>

	<path id="test-junit.classpath">
		<pathelement path="${project.dir}/lib/development/junit.jar" />
		<pathelement path="${project.dir}/test/classes" />
	</path>

	<path id="test-ejb.classpath">
		<path refid="project.classpath" />
		<fileset dir="${app.server.dir}/lib" includes="*.jar" />
		<fileset dir="${app.server.instance.dir}/lib" includes="*.jar" />
	</path>

	<path id="test-http.classpath">
		<path refid="project.classpath" />
	</path>

	<path id="test-ldap.classpath">
		<path refid="test-junit.classpath" />
	</path>

	<path id="test-soap.classpath">
		<path refid="web.classpath" />
		<path refid="test-junit.classpath" />
		<pathelement path="${project.dir}/lib/development/activation.jar" />
		<pathelement path="${project.dir}/lib/development/mail.jar" />
		<pathelement path="${project.dir}/lib/portal/axis.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-discovery.jar" />
		<pathelement path="${project.dir}/lib/portal/commons-logging.jar" />
		<pathelement path="${project.dir}/lib/portal/jaxrpc.jar" />
		<pathelement path="${project.dir}/lib/portal/saaj.jar" />
		<pathelement path="${project.dir}/lib/portal/wsdl4j.jar" />
		<pathelement path="${project.dir}/portal-client/portal-client.jar" />
	</path>

	<target name="compile">
		<mkdir dir="classes" />

		<path id="test-compile.classpath">
			<path refid="test-soap.classpath" />
			<pathelement path="${project.dir}/portal-ejb/classes" />
		</path>

		<javac
			classpathref="test-compile.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="classes"
			fork="${javac.fork}"
			memoryMaximumSize="${javac.memoryMaximumSize}"
			nowarn="on"
			srcdir="src"
		/>
	</target>

	<target name="test">
		<echo message="The remoting tests require a running Liferay instance. Make sure that Liferay" />
		<echo message="is listening on a host that matches what is set in test.properties." />
		<echo message="" />

		<antcall target="test-ejb" />
		<antcall target="test-http" />
		<antcall target="test-service" />
		<antcall target="test-soap" />
	</target>

	<target name="test-ejb" depends="compile">
		<java
			classname="com.liferay.test.EJBTests"
			classpathref="test-ejb.classpath"
			fork="true"
			newenvironment="true"
		>
			<jvmarg value="-Djava.security.auth.login.config=${app.server.dir}/client/auth.conf" />
		</java>
	</target>

	<target name="test-http" depends="compile">
		<java
			classname="com.liferay.test.http.HttpTests"
			classpathref="test-http.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-ldap" depends="compile">
		<java
			classname="com.liferay.test.ldap.LDAPTests"
			classpathref="test-ldap.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>

	<target name="test-service" depends="compile">
		<java
			classname="com.liferay.test.service.ServiceTests"
			classpathref="project.classpath"
			fork="true"
			newenvironment="true"
		>
			<!--<jvmarg value="-Dorg.xml.sax.driver=org.apache.xerces.parsers.SAXParser" />-->
		</java>
	</target>

	<target name="test-soap" depends="compile">
		<java
			classname="com.liferay.test.client.SoapTests"
			classpathref="test-soap.classpath"
			fork="true"
			newenvironment="true"
		/>
	</target>
</project>