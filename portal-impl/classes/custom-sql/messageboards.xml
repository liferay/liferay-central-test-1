<?xml version="1.0"?>

<custom-sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBMessageFinder.countByCategoryIds">
		<![CDATA[
			SELECT
				COUNT(*) AS COUNT_VALUE
			FROM
				MBMessage
			WHERE
				[$CATEGORY_ID$]
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBMessageFinder.countByGroupId">
		<![CDATA[
			SELECT
				COUNT(*) AS COUNT_VALUE
			FROM
				MBMessage
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			WHERE
				(MBCategory.groupId = ?)
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBMessageFlagFinder.countByU_T">
		<![CDATA[
			SELECT
				COUNT(*) AS COUNT_VALUE
			FROM
				MBMessageFlag
			INNER JOIN
				MBMessage ON
					(MBMessage.messageId = MBMessageFlag.messageId)
			WHERE
				(MBMessageFlag.userId = ?) AND
				(MBMessage.threadId = ?)
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBMessageFinder.findByGroupId">
		<![CDATA[
			SELECT
				{MBMessage.*}
			FROM
				MBMessage
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			WHERE
				(MBCategory.groupId = ?)
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBThreadFinder.countByCategoryIds">
		<![CDATA[
			SELECT
				COUNT(*) AS COUNT_VALUE
			FROM
				MBThread
			WHERE
				[$CATEGORY_ID$]
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBThreadFinder.countByGroupId">
		<![CDATA[
			SELECT
				COUNT(DISTINCT MBThread.threadId) AS COUNT_VALUE
			FROM
				MBThread
			INNER JOIN
				MBMessage ON
					(MBMessage.threadId = MBThread.threadId)
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			WHERE
				(MBCategory.groupId = ?)
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBThreadFinder.countByG_U">
		<![CDATA[
			SELECT
				COUNT(DISTINCT MBThread.threadId) AS COUNT_VALUE
			FROM
				MBThread
			INNER JOIN
				MBMessage ON
					(MBMessage.threadId = MBThread.threadId)
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			WHERE
				(MBCategory.groupId = ?) AND
				(MBMessage.userId = ?)
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBThreadFinder.findByGroupId">
		<![CDATA[
			SELECT
				DISTINCT {MBThread.*}
			FROM
				MBThread
			INNER JOIN
				MBMessage ON
					(MBMessage.threadId = MBThread.threadId)
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			WHERE
				(MBCategory.groupId = ?)
			ORDER BY
				MBThread.priority DESC,
				MBThread.lastPostDate DESC
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBThreadFinder.findByG_U">
		<![CDATA[
			SELECT
				DISTINCT {MBThread.*}
			FROM
				MBThread
			INNER JOIN
				MBMessage ON
					(MBMessage.threadId = MBThread.threadId)
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			WHERE
				(MBCategory.groupId = ?) AND
				(MBMessage.userId = ?)
			ORDER BY
				MBThread.priority DESC,
				MBThread.lastPostDate DESC
		]]>
	</sql>
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBThreadFinder.countSubscriptionsByG_U">
		<![CDATA[
			SELECT
				COUNT(DISTINCT MBThread.threadId) AS COUNT_VALUE
			FROM
				MBThread
			INNER JOIN
				MBMessage ON
					(MBMessage.threadId = MBThread.threadId)
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			INNER JOIN
				Subscription ON
					(Subscription.classPK = MBThread.threadId AND Subscription.classNameId = ?)
			WHERE
				(MBCategory.groupId = ?) AND
				(Subscription.userId = ?)
		]]>
	</sql>	
	<sql id="com.liferay.portlet.messageboards.service.persistence.MBThreadFinder.findSubscriptionsByG_U">
		<![CDATA[
			SELECT
				DISTINCT {MBThread.*}
			FROM
				MBThread
			INNER JOIN
				MBMessage ON
					(MBMessage.threadId = MBThread.threadId)
			INNER JOIN
				MBCategory ON
					(MBCategory.categoryId = MBMessage.categoryId)
			INNER JOIN
				Subscription ON
					(Subscription.classPK = MBThread.threadId AND Subscription.classNameId = ?)
			WHERE
				(MBCategory.groupId = ?) AND
				(Subscription.userId = ?)
			ORDER BY
				MBThread.priority DESC,
				MBThread.lastPostDate DESC
		]]>
	</sql>	
</custom-sql>