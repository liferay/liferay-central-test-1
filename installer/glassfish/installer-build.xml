<?xml version="1.0"?>

<project name="installer-build"  basedir="${basedir}" default="install">
	<property environment="env" />

	<property file="${basedir}/ant.install.properties" />
	<property file="${basedir}/installer-build.properties" />

	<target name="install">
		<antcall target="unzip" />
		<antcall target="replace-directory-references" />
	</target>

	<target name="unzip">
		<unzip src="${app.server.glassfish.zip}" dest="${app.server.glassfish.install.dir}" />
	</target>

	<target name="replace-directory-references">
		<pathconvert
			property="app.server.glassfish.java.home.path.windows"
			targetos="windows"
		>
			<path>
				<pathelement location="${app.server.glassfish.java.home}" />
			</path>
		</pathconvert>

		<pathconvert
			property="app.server.glassfish.dir.path.windows"
			targetos="windows"
		>
			<path>
				<pathelement location="${app.server.glassfish.dir}" />
			</path>
		</pathconvert>

		<replace
			dir="${app.server.glassfish.install.dir}"
			includes="**/*.bat,**/imqenv.conf,**/sun-acc.xml,**/service.properties"
		>
			<replacefilter
				token="${app.server.glassfish.java.home}"
				value="${env.JAVA_HOME}"
			/>
			<replacefilter
				token="${app.server.glassfish.java.home.path.windows}"
				value="${env.JAVA_HOME}"
			/>
			<replacefilter
				token="${app.server.glassfish.dir}"
				value="${app.server.glassfish.install.dir}"
			/>
			<replacefilter
				token="${app.server.glassfish.dir.path.windows}"
				value="${app.server.glassfish.install.dir}"
			/>
		</replace>
	</target>
</project>