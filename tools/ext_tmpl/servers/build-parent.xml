<?xml version="1.0"?>

<project name="servers-parent">
	<import file="../build-common.xml" />

	<target name="clean-oc4j">
		<delete dir="${app.server.oc4j.dir}/oc4j" />
		<mkdir dir="${app.server.oc4j.dir}/oc4j" />
	</target>

	<target name="clean-orion">
		<delete dir="${app.server.orion.dir}/orion" />
	</target>

	<target name="install-server">
		<antcall target="setproxy" />

		<if>
			<http url="${app.server.zip.url}" />
			<then>
				<get
					src="${app.server.zip.url}"
					dest="${downloads.dir}/${app.server.zip.name}"
					usetimestamp="true"
					verbose="true"
				/>
			</then>
		</if>

		<if>
			<available file="${downloads.dir}/${app.server.zip.name}" />
			<then>
				<unzip
					src="${downloads.dir}/${app.server.zip.name}"
					dest="${app.server.dest}"
				/>
			</then>
			<else>
				<echo message="Please manually download ${app.server.zip.url} to ${downloads.dir}/${app.server.zip.name}." />
			</else>
		</if>
	</target>

	<target name="install-jboss-jetty">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.jboss-jetty.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.jboss-jetty.zip.name}" />
			<param name="app.server.dest" value="${app.server.jboss-jetty.dir}" />
		</antcall>
	</target>

	<target name="install-jboss-tomcat">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.jboss-tomcat.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.jboss-tomcat.zip.name}" />
			<param name="app.server.dest" value="${app.server.jboss-tomcat.dir}" />
		</antcall>
	</target>

	<target name="install-jetty">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.jetty.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.jetty.zip.name}" />
			<param name="app.server.dest" value="${app.server.jetty.dir}" />
		</antcall>
	</target>

	<target name="install-jonas-jetty">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.jonas-jetty.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.jonas-jetty.zip.name}" />
			<param name="app.server.dest" value="${app.server.jonas-jetty.dir}" />
		</antcall>
	</target>

	<target name="install-jonas-tomcat">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.jonas-tomcat.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.jonas-tomcat.zip.name}" />
			<param name="app.server.dest" value="${app.server.jonas-tomcat.dir}" />
		</antcall>
	</target>

	<target name="install-oc4j">
		<!--<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.oc4j.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.oc4j.zip.name}" />
			<param name="app.server.dest" value="${app.server.oc4j.dir}/oc4j" />
		</antcall>-->

		<unzip
			src="${downloads.dir}/${app.server.oc4j.zip.name}"
			dest="${app.server.oc4j.dir}/oc4j"
		/>

		<mkdir dir="${app.server.oc4j.dir}/jsp/lib/taglib" />
		<mkdir dir="${app.server.oc4j.dir}/log" />
		<mkdir dir="${app.server.oc4j.dir}/persistence/ejb" />

		<antcall target="configure-oc4j" />
	</target>

	<target name="install-orion">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.orion.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.orion.zip.name}" />
			<param name="app.server.dest" value="${app.server.orion.dir}" />
		</antcall>

		<mkdir dir="${app.server.orion.dir}/log" />
		<mkdir dir="${app.server.orion.dir}/persistence/ejb" />

		<delete dir="${app.server.orion.dir}/orion/applications" />
		<delete dir="${app.server.orion.dir}/orion/database" />
		<delete dir="${app.server.orion.dir}/orion/default-web-app" />
		<delete dir="${app.server.orion.dir}/orion/demo" />
		<delete dir="${app.server.orion.dir}/orion/docs" />
		<delete dir="${app.server.orion.dir}/orion/config" />
		<delete dir="${app.server.orion.dir}/orion/lib" />
		<delete dir="${app.server.orion.dir}/orion/log" />
		<delete dir="${app.server.orion.dir}/orion/persistence" />

		<antcall target="configure-orion" />
	</target>

	<target name="install-resin">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.resin.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.resin.zip.name}" />
			<param name="app.server.dest" value="${app.server.resin.dir}" />
		</antcall>
	</target>

	<target name="install-tomcat">
		<antcall target="install-server">
			<param name="app.server.zip.url" value="${app.server.tomcat.zip.url}" />
			<param name="app.server.zip.name" value="${app.server.tomcat.zip.name}" />
			<param name="app.server.dest" value="${app.server.tomcat.dir}" />
		</antcall>
	</target>

	<target name="configure-oc4j">
		<replace file="${app.server.oc4j.dir}/config/server.xml">
			<replacefilter
				token="@rt.jar.path@"
				value="${env.JAVA_HOME}${file.separator}jre${file.separator}lib${file.separator}rt.jar"
			/>
		</replace>
	</target>

	<target name="configure-orion">
		<replace file="${app.server.orion.dir}/config/server.xml">
			<replacefilter
				token="@rt.jar.path@"
				value="${env.JAVA_HOME}${file.separator}jre${file.separator}lib${file.separator}rt.jar"
			/>
		</replace>
	</target>
</project>