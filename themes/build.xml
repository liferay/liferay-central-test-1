<?xml version="1.0"?>

<project name="themes" basedir="." default="deploy">
	<import file="../build-common-plugin.xml" />

	<property name="plugin.jar.excludes" value="_diffs.*,_diffs/**" />
	<property name="common.themes.src.dir" value="${project.dir}/portal-web/docroot/html/themes" />

	<target name="clean-module">
		<if>
			<available file="${module.name}.war/_diffs" />
			<then>
				<delete includeemptydirs="true" quiet="true" failonerror="false">
					<fileset
						dir="${module.name}.war"
						excludes="${plugin.jar.excludes},WEB-INF/**"
					/>
				</delete>
			</then>
		</if>
	</target>

	<target name="compile-module">
		<if>
			<isfileselected file="${module.name}.war">
				<type type="file" />
			</isfileselected>
			<then>
				<echo>Skipping packed module ${module.name}.war</echo>
			</then>
			<else>
				<if>
					<available file="${module.name}.war/_diffs" />
					<then>
						<if>
							<available file="${module.name}.war/_diffs.unstyled" />
							<then>
								<copy todir="${module.name}.war" overwrite="yes">
									<fileset
										dir="${common.themes.src.dir}/_unstyled"
										excludes="templates/init.vm"
									/>
								</copy>
							</then>
							<else>
								<copy todir="${module.name}.war" overwrite="yes">
									<fileset
										dir="${common.themes.src.dir}/_unstyled"
										excludes="templates/init.vm"
									/>
								</copy>

								<copy todir="${module.name}.war" overwrite="yes">
									<fileset
										dir="${common.themes.src.dir}/_styled"
									/>
								</copy>
							</else>
						</if>

						<copy todir="${module.name}.war" overwrite="yes">
							<fileset
								dir="${module.name}.war/_diffs"
							/>
						</copy>
					</then>
				</if>
			</else>
		</if>
	</target>
</project>